<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>

        "use strict";

        const TARGET_PHRASE = "To be or not to be.";
        const GENES = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890,.-;:!?&'/()";
        const INDIVIDUAL_SIZE = TARGET_PHRASE.length;
        const POPULATION_SIZE = 100;
        const MUTATION_CHANCE = 0.01;
        const ELITISM_NUM = 5;

        //console.log(GENES.length);

        const population = [];

        function getRandomChar(genes) {
            const randomNumber = Math.random();
            const randomCharIndex = Math.floor(randomNumber * genes.length);
            const randomChar = genes.charAt(randomCharIndex);
            return randomChar;
        }

        function createPopulation(populationSize) {
            do {
                let phrase = "";
                for(let i = 0 ; i < INDIVIDUAL_SIZE ; i++) {
                    const randomChar = getRandomChar(GENES);
                    phrase += randomChar;
                }
                const individual = {
                    "phrase" : phrase,
                    "fitness" : 0
                }
                population.push(individual);
            } while(population.length < populationSize);
            //console.log(population);
        }

        function testPopulation() {
            population.forEach(individual => {
                let fitness = 0;
                for(let charIndex = 0; charIndex < INDIVIDUAL_SIZE; charIndex++) {
                    
                    if(individual.phrase[charIndex] === TARGET_PHRASE[charIndex]) {
                        fitness++
                    }
                }
                individual.fitness = fitness;
            });
        }

        function selection() {

            const sortedPopulation = population.sort((a, b) => b.fitness - a.fitness);

            const newPopulation = [];

            // Elitism
            const elite = sortedPopulation.slice(0, ELITISM_NUM);
            newPopulation.concat(elite);

            //console.log(elite);

            do {
                const parentA = tournamentSelection();
                const parentB = tournamentSelection();

                const child = recombination(parentA, parentB);

                newPopulation.push(child);
            } while(newPopulation.length < POPULATION_SIZE);

            //console.log(newPopulation);

            // Replace old population with new
            population.length = 0;
            population.push(...newPopulation);
        }

        function tournamentSelection() {
            
            const numTournamentParticipants = 20;

            const participants = [];
            
            for(let i = 0; i < numTournamentParticipants; i++) {
                const randomNumber = Math.random();
                const randomPopulationIndex = Math.floor(randomNumber * POPULATION_SIZE);
                const randomIndividual = population[randomPopulationIndex];
                participants.push(randomIndividual);
            }

            const sortedParticipants = participants.sort((a, b) => b.fitness - a.fitness);
            const winner = sortedParticipants[0];
            return winner;
        }

        function recombination(parentA, parentB) {
            let childPhrase = "";
            for(let i = 0; i < INDIVIDUAL_SIZE; i++) {
                const randomNumber = Math.random();
                if(randomNumber > 0.5) {
                    childPhrase += parentA.phrase[i];
                } else {
                    childPhrase += parentB.phrase[i];
                }
            }

            const child = {
                "phrase" : childPhrase,
                "fitness" : 0
            }

            return child;
        }

        function mutation() {
            population.forEach(individual => {
                for (let charIndex = 0; charIndex < INDIVIDUAL_SIZE; charIndex++) {
                    const randomNumber = Math.random();
                    if (randomNumber <= MUTATION_CHANCE) {
                        const randomChar = getRandomChar(GENES);

                        // Create a new string and assign it back to individual.phrase
                        individual.phrase =
                            individual.phrase.slice(0, charIndex) + // Part before the index
                            randomChar +                             // The new character
                            individual.phrase.slice(charIndex + 1);  // Part after the index
                    }
                }
            });
        }

        //

        createPopulation(POPULATION_SIZE);

        for(let iterations = 0; iterations < 200; iterations++) {
            testPopulation();

            selection();

            mutation();

        }

        console.log(population[0]); 

    </script>
</body>
</html>